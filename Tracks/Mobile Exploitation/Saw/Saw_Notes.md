# Investigator - HTB Writeup

[![Hack The Box](https://img.shields.io/badge/HackTheBox-SAW-yellow?logo=hackthebox)](https://app.hackthebox.com/challenges/286)
[![Difficulty: Medium](https://img.shields.io/badge/Difficulty-Medium-yellow)](https://github.com/subhash00/HackTheBox/)
[![Platform: Android](https://img.shields.io/badge/Platform-Android-brightgreen)](https://github.com/subhash00/HackTheBox/)
[![Topic: Mobile Security](https://img.shields.io/badge/Topic-Mobile%20Security-blueviolet)](https://en.wikipedia.org/wiki/Mobile_security)

---

## Overview

This lab involves the malware forensics with a new technique for hiding and executing code dynamically. A sample that seems to use this technique has just arrived in their queue..

---

## Notes

### Logs data specefic to our app
```
adb logcat --pid=$(adb shell pidof com.stego.saw)
adb logcat | grep com.stego.saw 
```

### Launching the app/activity via adb
``` adb shell am start -n com.stego.saw/.MainActivity```

### Main activity path
``` smali/com/stego/saw/```

### Send data or parameters to an activity when launching it via adb commands
```
adb shell am start -n com.stego.saw/.MainActivity --es open sesame
```
- es: Stands for extra string, used to add a string key-value pair to the intent. Here string name is "open" and value is "sesame".
- Code Reference: String openValue = getIntent().getExtras().getString("open");

### Grant the permission of SYSTEM_ALERT_WINDOW
``` adb shell appops set com.stego.saw SYSTEM_ALERT_WINDOW allow```
- appops : [Application Operations Manager, handled by the AppOpsManager service] controls how apps use sensitive system operations, such as location, camera, clipboard, or overlay windows.

### On Xorify click, it calls
- a(FILE_PATH_PREFIX, answer)
- Here a() is native library loaded earlier
- Code Refernce : " System.loadLibrary("default");"

### Reverse Engineering
- libdefault.so > Symbol Tree > function a > function _Z1aP7_JNIEnvP8_1
- Understand the XOR logic
- Prepare python script to reverse it, got input string "fl0ating"

### Add input via adb and click on XORIFY
``` adb shell input text "fl0ating"```

### Data being written on following path
``` /data/data/com.stego.saw/h```
- Code Reference : FILE_PATH_PREFIX = getApplicationContext().getApplicationInfo().dataDir + File.separator;

### For Flag 
- Navigate to /data/data/com.stego.saw/
```cat h```

---

# Investigator - HTB Writeup

[![Hack The Box](https://img.shields.io/badge/HackTheBox-Investigator-green?logo=hackthebox)](https://app.hackthebox.com/challenges/426)
[![Difficulty: Medium](https://img.shields.io/badge/Difficulty-Medium-yellow)](https://github.com/subhash00/HackTheBox/)
[![Platform: Android](https://img.shields.io/badge/Platform-Android-brightgreen)](https://github.com/subhash00/HackTheBox/)
[![Topic: Mobile Security](https://img.shields.io/badge/Topic-Mobile%20Security-blueviolet)](https://en.wikipedia.org/wiki/Mobile_security)

---

## Overview

This lab involves extracting and decrypting data from an Android backup file (`backup.ab`), cracking a salted SHA1 password hash, and decrypting a WhatsApp encrypted backup. The challenge teaches important skills around Android forensic analysis, encryption, and password recovery using custom scripts and tools.

---

## Table of Contents

- [Overview](#overview)  
- [Steps](#steps)  
- [Tools & Scripts](#tools--scripts)  
- [Technologies Used](#technologies-used)  

---

## Steps

1. Initial data and files were received for solving this lab.
<img width="719" height="373" alt="1" src="https://github.com/user-attachments/assets/3e8887e0-2e2e-4b83-bf9d-3e722c551431" />

2. Attempted to extract the `backup.ab` Android backup using the command:
`dd if=backup.ab bs=1 skip=24 | openssl zlib -d | tar -xvf -`
- This failed with a zlib data error indicating an invalid tar archive.
<img width="1235" height="107" alt="2" src="https://github.com/user-attachments/assets/2bcb625c-dff1-4067-87d7-6d894718f959" />

3. Switched to using `abe.jar` (Android Backup Extractor) to extract the backup. It required a password to proceed.
<img width="1866" height="327" alt="3" src="https://github.com/user-attachments/assets/b44021e2-df2f-4c07-8c89-67c718b3a792" />

4. Discovered the password is stored in the `Password.key` file inside the system files.
<img width="1115" height="320" alt="4" src="https://github.com/user-attachments/assets/e72c91de-a1bd-4e4c-acd8-b3abdd304529" />

5. Navigated to the `System` directory and opened `locksettings.db` using SQLite to find the password salt.
<img width="881" height="567" alt="5" src="https://github.com/user-attachments/assets/1d5264df-5945-454b-8a42-2f2571159333" />

6. Converted the decimal salt value to hexadecimal using:
`printf '%x\n' 6675990079707233028`
<img width="450" height="89" alt="6" src="https://github.com/user-attachments/assets/83b87b47-dd56-4351-b75c-cd306315176b" />

7. Created a Python script to crack the SHA1 salted hash; successfully retrieved the password `dycpr`.
<img width="791" height="134" alt="7" src="https://github.com/user-attachments/assets/bf28da46-855a-4b1c-8fb4-efca28337dc3" />

8. Extracted the backup using `abe.jar` commands:
```
java -jar abe.jar unpack backup.ab backup.tar
tar -xvf backup.tar
```
<img width="1902" height="573" alt="8" src="https://github.com/user-attachments/assets/699db20d-ada8-4c31-902c-56be8b8d91de" />

9. Observed the encrypted WhatsApp backup database file.
<img width="452" height="101" alt="9" src="https://github.com/user-attachments/assets/c9fa071f-7a85-4e29-96c8-eca2d23dde94" />

10. Decrypted the WhatsApp database using the Python script from  
 [WhatsApp-Crypt14-Decrypter](https://github.com/pharaoh1/WhatsApp-Crypt14-Decrypter) with key located at `/apps/com.whatsapp/f/`:
 ```
 python3 decrypt14.py key msgstore.db.crypt14
 ```
<img width="1615" height="194" alt="10" src="https://github.com/user-attachments/assets/5fc0cec5-ee70-4852-95c3-788ee35fd8e3" />

11. Extracted and observed the flag inside the WhatsApp `message` table.
<img width="1569" height="708" alt="11" src="https://github.com/user-attachments/assets/776f4ca3-3e6e-4073-9f17-aa02d359e86a" />

---

## Tools & Scripts

- `abe.jar` - Android Backup Extractor for unpacking `.ab` files  
- Python script for cracking SHA1 salted hash (custom created during lab)  
- `WhatsApp-Crypt14-Decrypter` by pharaoh1 for decrypting WhatsApp `.crypt14` databases  
- SQLite3 - for analyzing Android database files like `locksettings.db`  
- `dd`, `openssl`, `tar` - for initial backup extraction attempts  
- Custom Grepper.py script - Recursively searched files for sensitive keywords (used during investigation)

---

## Technologies Used

- Android backup system (`.ab`, `.crypt14`)  
- SQLite database analysis  
- SHA1 salted hashing and cracking
- WhatsApp encrypted message storage format  
- Java (for `abe.jar`)  
- Python scripting and cryptography

---
